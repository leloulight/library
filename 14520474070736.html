<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  ActionBar 使用指南 - 小土刀的笔记
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="小土刀的笔记" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">小土刀的笔记</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 小土刀的笔记</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>清单</label></li>

          
            <li><a title="好问题收集" href="14520379720179.html">好问题收集</a></li>
          
            <li><a title="书单合集" href="14520379720136.html">书单合集</a></li>
          
            <li><a title="日志列表" href="14520379720098.html">日志列表</a></li>
          
            <li><a title="玩物列表" href="14520379720223.html">玩物列表</a></li>
          

      
        <li class="divider"></li>
        <li><label>计算机学科经典</label></li>

          
            <li><a title="大教堂与集市" href="14520876353363.html">大教堂与集市</a></li>
          
            <li><a title="深入理解计算机系统" href="14520855371865.html">深入理解计算机系统</a></li>
          
            <li><a title="Python Algorithm" href="14521091296885.html">Python Algorithm</a></li>
          
            <li><a title="程序员的思维修炼" href="14520875018555.html">程序员的思维修炼</a></li>
          
            <li><a title="程序员修炼之道" href="14520874386531.html">程序员修炼之道</a></li>
          
            <li><a title="高效程序员的45个习惯" href="14520878121031.html">高效程序员的45个习惯</a></li>
          
            <li><a title="代码大全" href="14520855371782.html">代码大全</a></li>
          
            <li><a title="编写可读代码的艺术" href="14520874726715.html">编写可读代码的艺术</a></li>
          
            <li><a title="移动应用UI设计模式" href="14520886280669.html">移动应用UI设计模式</a></li>
          
            <li><a title="启示录：打造用户喜爱的产品" href="14520907410466.html">启示录：打造用户喜爱的产品</a></li>
          
            <li><a title="亲爱的界面：让用户乐于使用、爱不释手" href="14520885573483.html">亲爱的界面：让用户乐于使用、爱不释手</a></li>
          
            <li><a title="简约之美：软件设计之道" href="14520879229686.html">简约之美：软件设计之道</a></li>
          
            <li><a title="简单之美：软件开发实践者的思考" href="14520878623936.html">简单之美：软件开发实践者的思考</a></li>
          
            <li><a title="构建之法：现代软件工程" href="14520880342127.html">构建之法：现代软件工程</a></li>
          
            <li><a title="软件项目成功之道" href="14520883368873.html">软件项目成功之道</a></li>
          

      
        <li class="divider"></li>
        <li><label>工具平台</label></li>

          
            <li><a title="Mac 指南" href="14520959875185.html">Mac 指南</a></li>
          
            <li><a title="Bash 指南" href="14520940884566.html">Bash 指南</a></li>
          
            <li><a title="Hexo 指南" href="14520953748408.html">Hexo 指南</a></li>
          
            <li><a title="VS Code 指南" href="14520964818956.html">VS Code 指南</a></li>
          
            <li><a title="Homebrew 指南" href="14520954251052.html">Homebrew 指南</a></li>
          
            <li><a title="Hadoop 指南" href="14521186972719.html">Hadoop 指南</a></li>
          
            <li><a title="Pandoc 指南" href="14520962259349.html">Pandoc 指南</a></li>
          
            <li><a title="Vim 指南" href="14520964365928.html">Vim 指南</a></li>
          
            <li><a title="Sublime 指南" href="14520965272426.html">Sublime 指南</a></li>
          
            <li><a title="GFW 原理指南" href="14521185605970.html">GFW 原理指南</a></li>
          
            <li><a title="Linux 的概念与体系" href="14521103801032.html">Linux 的概念与体系</a></li>
          
            <li><a title="Appstore 生存指南" href="14521185605800.html">Appstore 生存指南</a></li>
          
            <li><a title="Latex 指南" href="14520955052445.html">Latex 指南</a></li>
          
            <li><a title="Git 指南" href="14520951022304.html">Git 指南</a></li>
          
            <li><a title="Github 生活指南" href="14520951022388.html">Github 生活指南</a></li>
          
            <li><a title="iTerm2 指南" href="14520954757815.html">iTerm2 指南</a></li>
          
            <li><a title="Ubuntu 指南" href="14520961679182.html">Ubuntu 指南</a></li>
          
            <li><a title="谷歌搜索技巧" href="14520951022464.html">谷歌搜索技巧</a></li>
          
            <li><a title="Make 指南" href="14520961098604.html">Make 指南</a></li>
          
            <li><a title="GCC 简易指南" href="14520948089088.html">GCC 简易指南</a></li>
          
            <li><a title="Kinect 开发指南" href="14521185098750.html">Kinect 开发指南</a></li>
          
            <li><a title="fish shell 指南" href="14520943310829.html">fish shell 指南</a></li>
          
            <li><a title="Gradle 指南" href="14520951022555.html">Gradle 指南</a></li>
          

      
        <li class="divider"></li>
        <li><label>编程语言</label></li>

          
            <li><a title="如何选择编程语言" href="14521020035250.html">如何选择编程语言</a></li>
          
            <li><a title="Python 学习指南" href="14521095530236.html">Python 学习指南</a></li>
          
            <li><a title="Python 编程思想" href="14521096832549.html">Python 编程思想</a></li>
          
            <li><a title="Java 精要" href="14521089938127.html">Java 精要</a></li>
          
            <li><a title="Matlab 指南" href="14521020962952.html">Matlab 指南</a></li>
          
            <li><a title="OpenMP 入门指南" href="14521021178707.html">OpenMP 入门指南</a></li>
          
            <li><a title="Javascript 学习指南" href="14521020732534.html">Javascript 学习指南</a></li>
          
            <li><a title="C++ 学习笔记" href="14520969294593.html">C++ 学习笔记</a></li>
          
            <li><a title="SQL 入门指南" href="14521021831775.html">SQL 入门指南</a></li>
          
            <li><a title="CUDA架构" href="14521020248399.html">CUDA架构</a></li>
          

      
        <li class="divider"></li>
        <li><label>Research</label></li>

          
            <li><a title="知识图谱沉思录" href="14520583101537.html">知识图谱沉思录</a></li>
          
            <li><a title="计算机视觉沉思录" href="14520483585854.html">计算机视觉沉思录</a></li>
          
            <li><a title="推荐系统沉思录" href="14520495721664.html">推荐系统沉思录</a></li>
          
            <li><a title="数据分析沉思录" href="14520494829635.html">数据分析沉思录</a></li>
          
            <li><a title="机器学习沉思录" href="14520493984651.html">机器学习沉思录</a></li>
          
            <li><a title="3D 打印沉思录" href="14520902603411.html">3D 打印沉思录</a></li>
          
            <li><a title="HMM 指南" href="14520495021796.html">HMM 指南</a></li>
          
            <li><a title="EM / GMM 指南" href="14520494287936.html">EM / GMM 指南</a></li>
          

      
        <li class="divider"></li>
        <li><label>iOS</label></li>

          
            <li><a title="iOS 学习路径" href="14520467690026.html">iOS 学习路径</a></li>
          
            <li><a title="iOS 面试相关" href="14520467689968.html">iOS 面试相关</a></li>
          

      
        <li class="divider"></li>
        <li><label>Android</label></li>

          
            <li><a title="Android Studio 指南" href="14520922857884.html">Android Studio 指南</a></li>
          
            <li><a title="Google Map V2 使用指南" href="14520474070782.html">Google Map V2 使用指南</a></li>
          
            <li><a title="ActionBar 使用指南" href="14520474070736.html">ActionBar 使用指南</a></li>
          

      
        <li class="divider"></li>
        <li><label>Web</label></li>

          
            <li><a title="网络协议指南" href="14520476779491.html">网络协议指南</a></li>
          
            <li><a title="Node.js 命令行程序实例" href="14520476779456.html">Node.js 命令行程序实例</a></li>
          
            <li><a title="Flask Study Note" href="14520476779406.html">Flask Study Note</a></li>
          

      
        <li class="divider"></li>
        <li><label>关于</label></li>

          
            <li><a title="版权声明" href="14520576386063.html">版权声明</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>清单</span></li>
                        
                          <li><a title="好问题收集" href="14520379720179.html">好问题收集</a></li>
                        
                          <li><a title="书单合集" href="14520379720136.html">书单合集</a></li>
                        
                          <li><a title="日志列表" href="14520379720098.html">日志列表</a></li>
                        
                          <li><a title="玩物列表" href="14520379720223.html">玩物列表</a></li>
                        

                    
                      <li class="side-title"><span>计算机学科经典</span></li>
                        
                          <li><a title="大教堂与集市" href="14520876353363.html">大教堂与集市</a></li>
                        
                          <li><a title="深入理解计算机系统" href="14520855371865.html">深入理解计算机系统</a></li>
                        
                          <li><a title="Python Algorithm" href="14521091296885.html">Python Algorithm</a></li>
                        
                          <li><a title="程序员的思维修炼" href="14520875018555.html">程序员的思维修炼</a></li>
                        
                          <li><a title="程序员修炼之道" href="14520874386531.html">程序员修炼之道</a></li>
                        
                          <li><a title="高效程序员的45个习惯" href="14520878121031.html">高效程序员的45个习惯</a></li>
                        
                          <li><a title="代码大全" href="14520855371782.html">代码大全</a></li>
                        
                          <li><a title="编写可读代码的艺术" href="14520874726715.html">编写可读代码的艺术</a></li>
                        
                          <li><a title="移动应用UI设计模式" href="14520886280669.html">移动应用UI设计模式</a></li>
                        
                          <li><a title="启示录：打造用户喜爱的产品" href="14520907410466.html">启示录：打造用户喜爱的产品</a></li>
                        
                          <li><a title="亲爱的界面：让用户乐于使用、爱不释手" href="14520885573483.html">亲爱的界面：让用户乐于使用、爱不释手</a></li>
                        
                          <li><a title="简约之美：软件设计之道" href="14520879229686.html">简约之美：软件设计之道</a></li>
                        
                          <li><a title="简单之美：软件开发实践者的思考" href="14520878623936.html">简单之美：软件开发实践者的思考</a></li>
                        
                          <li><a title="构建之法：现代软件工程" href="14520880342127.html">构建之法：现代软件工程</a></li>
                        
                          <li><a title="软件项目成功之道" href="14520883368873.html">软件项目成功之道</a></li>
                        

                    
                      <li class="side-title"><span>工具平台</span></li>
                        
                          <li><a title="Mac 指南" href="14520959875185.html">Mac 指南</a></li>
                        
                          <li><a title="Bash 指南" href="14520940884566.html">Bash 指南</a></li>
                        
                          <li><a title="Hexo 指南" href="14520953748408.html">Hexo 指南</a></li>
                        
                          <li><a title="VS Code 指南" href="14520964818956.html">VS Code 指南</a></li>
                        
                          <li><a title="Homebrew 指南" href="14520954251052.html">Homebrew 指南</a></li>
                        
                          <li><a title="Hadoop 指南" href="14521186972719.html">Hadoop 指南</a></li>
                        
                          <li><a title="Pandoc 指南" href="14520962259349.html">Pandoc 指南</a></li>
                        
                          <li><a title="Vim 指南" href="14520964365928.html">Vim 指南</a></li>
                        
                          <li><a title="Sublime 指南" href="14520965272426.html">Sublime 指南</a></li>
                        
                          <li><a title="GFW 原理指南" href="14521185605970.html">GFW 原理指南</a></li>
                        
                          <li><a title="Linux 的概念与体系" href="14521103801032.html">Linux 的概念与体系</a></li>
                        
                          <li><a title="Appstore 生存指南" href="14521185605800.html">Appstore 生存指南</a></li>
                        
                          <li><a title="Latex 指南" href="14520955052445.html">Latex 指南</a></li>
                        
                          <li><a title="Git 指南" href="14520951022304.html">Git 指南</a></li>
                        
                          <li><a title="Github 生活指南" href="14520951022388.html">Github 生活指南</a></li>
                        
                          <li><a title="iTerm2 指南" href="14520954757815.html">iTerm2 指南</a></li>
                        
                          <li><a title="Ubuntu 指南" href="14520961679182.html">Ubuntu 指南</a></li>
                        
                          <li><a title="谷歌搜索技巧" href="14520951022464.html">谷歌搜索技巧</a></li>
                        
                          <li><a title="Make 指南" href="14520961098604.html">Make 指南</a></li>
                        
                          <li><a title="GCC 简易指南" href="14520948089088.html">GCC 简易指南</a></li>
                        
                          <li><a title="Kinect 开发指南" href="14521185098750.html">Kinect 开发指南</a></li>
                        
                          <li><a title="fish shell 指南" href="14520943310829.html">fish shell 指南</a></li>
                        
                          <li><a title="Gradle 指南" href="14520951022555.html">Gradle 指南</a></li>
                        

                    
                      <li class="side-title"><span>编程语言</span></li>
                        
                          <li><a title="如何选择编程语言" href="14521020035250.html">如何选择编程语言</a></li>
                        
                          <li><a title="Python 学习指南" href="14521095530236.html">Python 学习指南</a></li>
                        
                          <li><a title="Python 编程思想" href="14521096832549.html">Python 编程思想</a></li>
                        
                          <li><a title="Java 精要" href="14521089938127.html">Java 精要</a></li>
                        
                          <li><a title="Matlab 指南" href="14521020962952.html">Matlab 指南</a></li>
                        
                          <li><a title="OpenMP 入门指南" href="14521021178707.html">OpenMP 入门指南</a></li>
                        
                          <li><a title="Javascript 学习指南" href="14521020732534.html">Javascript 学习指南</a></li>
                        
                          <li><a title="C++ 学习笔记" href="14520969294593.html">C++ 学习笔记</a></li>
                        
                          <li><a title="SQL 入门指南" href="14521021831775.html">SQL 入门指南</a></li>
                        
                          <li><a title="CUDA架构" href="14521020248399.html">CUDA架构</a></li>
                        

                    
                      <li class="side-title"><span>Research</span></li>
                        
                          <li><a title="知识图谱沉思录" href="14520583101537.html">知识图谱沉思录</a></li>
                        
                          <li><a title="计算机视觉沉思录" href="14520483585854.html">计算机视觉沉思录</a></li>
                        
                          <li><a title="推荐系统沉思录" href="14520495721664.html">推荐系统沉思录</a></li>
                        
                          <li><a title="数据分析沉思录" href="14520494829635.html">数据分析沉思录</a></li>
                        
                          <li><a title="机器学习沉思录" href="14520493984651.html">机器学习沉思录</a></li>
                        
                          <li><a title="3D 打印沉思录" href="14520902603411.html">3D 打印沉思录</a></li>
                        
                          <li><a title="HMM 指南" href="14520495021796.html">HMM 指南</a></li>
                        
                          <li><a title="EM / GMM 指南" href="14520494287936.html">EM / GMM 指南</a></li>
                        

                    
                      <li class="side-title"><span>iOS</span></li>
                        
                          <li><a title="iOS 学习路径" href="14520467690026.html">iOS 学习路径</a></li>
                        
                          <li><a title="iOS 面试相关" href="14520467689968.html">iOS 面试相关</a></li>
                        

                    
                      <li class="side-title"><span>Android</span></li>
                        
                          <li><a title="Android Studio 指南" href="14520922857884.html">Android Studio 指南</a></li>
                        
                          <li><a title="Google Map V2 使用指南" href="14520474070782.html">Google Map V2 使用指南</a></li>
                        
                          <li><a title="ActionBar 使用指南" href="14520474070736.html">ActionBar 使用指南</a></li>
                        

                    
                      <li class="side-title"><span>Web</span></li>
                        
                          <li><a title="网络协议指南" href="14520476779491.html">网络协议指南</a></li>
                        
                          <li><a title="Node.js 命令行程序实例" href="14520476779456.html">Node.js 命令行程序实例</a></li>
                        
                          <li><a title="Flask Study Note" href="14520476779406.html">Flask Study Note</a></li>
                        

                    
                      <li class="side-title"><span>关于</span></li>
                        
                          <li><a title="版权声明" href="14520576386063.html">版权声明</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>ActionBar 使用指南</h1>

<p>因为在项目中需要使用 ActionBar 进行一些自定义操作以提高整体的视觉效果，所以研究了一下 ActionBar 的用法，在这里记录一下。</p>

<h2 id="toc_0">隐藏 ActionBar</h2>

<p>比较简单的方式就是换主题，在 Android 5 中就是在对应的 xml 文件里修改 <code>android:theme</code> 字段，或者也可以直接在 Activity 中用以下代码来隐藏：</p>

<pre><code class="language-android">ActionBar actionBar = getActionBar();
actionBar.hide();
</code></pre>

<h2 id="toc_1">修改图标和标题</h2>

<p>这一部分的操作都需要在 <code>AndroidManifest.xml</code> 中进行，而对于标题的绑定一般来说是在 <code>strings.xml</code> 里进行统一管理</p>

<pre><code class="language-xml">&lt;activity
  android:name=&quot;.ui.MainActivity&quot;
  android:label=&quot;@string/title_activity_main&quot; &gt;
&lt;/activity&gt;
</code></pre>

<p>修改标题，就是修改 label 属性，需要添加图标的话，就是添加一个 <code>android:logo</code> 字段即可</p>

<h2 id="toc_2">添加按钮</h2>

<p>ActionBar还可以根据应用程序当前的功能来提供与其相关的Action按钮，这些按钮都会以图标或文字的形式直接显示在ActionBar上。当然，如果按钮过多，ActionBar上显示不完，多出的一些按钮可以隐藏在overflow里面（最右边的三个点就是overflow按钮），点击一下overflow按钮就可以看到全部的Action按钮了。</p>

<p>当Activity启动的时候，系统会调用Activity的 <code>onCreateOptionsMenu()</code>方法来取出所有的Action按钮，我们只需要在这个方法中去加载一个menu资源，并把所有的Action按钮都定义在资源文件里面就可以了。像下面这样</p>

<pre><code class="language-xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    tools:context=&quot;lgm.cmu.spotagram.ui.MainActivity&quot;&gt;

    &lt;item android:id=&quot;@+id/action_search&quot;
        android:title=&quot;Search&quot;
        android:icon=&quot;@drawable/ic_check&quot;
        app:showAsAction=&quot;always&quot; /&gt;

    &lt;item android:id=&quot;@+id/action_nearby&quot;
        android:title=&quot;Near By&quot;
        android:logo=&quot;@drawable/ic_cast_dark&quot;
        app:showAsAction=&quot;always&quot; /&gt;

    &lt;item android:id=&quot;@+id/action_settings&quot;
        android:title=&quot;Settings&quot;
        android:orderInCategory=&quot;100&quot;
        app:showAsAction=&quot;never&quot; /&gt;
&lt;/menu&gt;
</code></pre>

<p>这里主要注意一下 <code>showAsAction</code> 属性即可：<code>always</code> 表示永远显示在 ActionBar 中，如果屏幕空间不够则无法显示，<code>ifRoom</code> 表示屏幕空间够的情况下显示在 ActionBar 中，不够的话就显示在 overflow 中，<code>never</code> 则表示永远显示在 overflow 中</p>

<p>然后重写对应 Activity 的 <code>onCreateOpitonsMenu()</code> 方法</p>

<pre><code class="language-java">@Override
public boolean onCreateOptionsMenu(Menu menu){
   MenuInflater inflater = getMenuInflater();
   inflater.inflate(R.menu.menu_main, menu);
   return super.onCreateOptionsMenu(menu);
}
</code></pre>

<p>是显示图标还是文字这个大家可以根据具体的需求来做，但是给每个 item 一个 title 属性是比较好的习惯，因为：</p>

<ul>
<li>当 ActionBar 中的剩余空间不足的时候，如果 Action 按钮指定的 showAsAction 属性是 ifRoom 的话，该 Action 按钮就会出现在 overflow 当中，此时就只有 title 能够显示了。</li>
<li>如果 Action 按钮在 ActionBar 中显示，用户可能通过长按该 Action 按钮的方式来查看到 title 的内容。</li>
</ul>

<h2 id="toc_3">给按钮添加点击事件</h2>

<p>当用户点击 Action 按钮的时候，系统会调用 Activity 的 <code>onOptionsItemSelected()</code> 方法，通过方法传入的 <code>MenuItem</code> 参数，我们可以调用它的 <code>getItemId()</code> 方法和 menu 资源中的 id 进行比较，从而辨别出用户点击的是哪一个 Action 按钮</p>

<pre><code class="language-java">@Override
public boolean onOptionsItemSelected(MenuItem item) {
   Intent intent;
   switch (item.getItemId()){
       case R.id.action_search:
           Toast.makeText(this, &quot;Search&quot;, Toast.LENGTH_SHORT).show();
           return true;
       case R.id.action_nearby:
           intent = new Intent(MainActivity.this, NearByActivity.class);
           startActivity(intent);
           return true;
       case R.id.action_settings:
           intent = new Intent(MainActivity.this, SettingsActivity.class);
           startActivity(intent);
           return true;
       case R.id.action_aboutme:
           intent = new Intent(MainActivity.this, AboutMeActivity.class);
           startActivity(intent);
           return true;
       default:
           return super.onOptionsItemSelected(item);
   }
}
</code></pre>

<h2 id="toc_4">通过 ActionBar 进行导航</h2>

<p>除了通过 back 按钮，同样可以在 ActionBar 上实现导航，只需要调用 <code>setDisplayHomeAsUpEnabled()</code> 方法启用即可：</p>

<pre><code class="language-java">@Override
protected void onCreate(Bundle savedInstanceState) {
   super.onCreate(savedInstanceState);
   setContentView(R.layout.activity_near_by);
   // 重点是这行
   getSupportActionBar().setDisplayHomeAsUpEnabled(true);

     // 以下是其他代码
   initComponments();
   initViews();
   initListeners();
}   
</code></pre>

<p>这样一来就会出现一个向左的箭头，我们给它加上点击事件，注意这里一定要是 <code>android.R.id.home</code> 才可以：</p>

<pre><code class="language-java">@Override
public boolean onOptionsItemSelected(MenuItem item) {
   switch (item.getItemId()){
       case android.R.id.home:
           finish();
           return true;
       default:
           return super.onOptionsItemSelected(item);
   }
}
</code></pre>

<p>但这样的用法实际上和 back 键没啥区别，不过其设计的初衷是支持层次调用的，比如说：</p>

<p><img src="media/14520474070736/14491739226392.png" alt="14491739226392"/></p>

<p>上图中的 Conversation List 是收件箱的主界面，现在我们点击第一封邮件会进入到Conversation1 details 界面，然后点击下一封邮件会进入到 Conversation 2 details 界面，再点击下一封邮箱会进入到 Conversation3 details 界面。好的，这个时候如果我们按下 Back 键，应该会回到 Conversation 2 details 界面，再按一次 Back 键应该回到 Conversation1 details 界面，再按一次 Back 键才会回到 Conversation List。而 ActionBar 导航则不应该表现出这种行为，无论我们当前在哪一个 Conversation details 界面，点击一下导航按钮都应该回到 Conversation List 界面才对。</p>

<p>实现标准的ActionBar导航功能只需三步走。</p>

<p>第一步我们已经实现了，就是调用setDisplayHomeAsUpEnabled()方法，并传入true。</p>

<p>第二步需要在AndroidManifest.xml中配置父Activity，如下所示：</p>

<pre><code class="language-xml">&lt;activity
    android:name=&quot;com.example.actionbartest.MainActivity&quot;
    android:logo=&quot;@drawable/weather&quot; &gt;
    &lt;meta-data
        android:name=&quot;android.support.PARENT_ACTIVITY&quot;
        android:value=&quot;com.example.actionbartest.LaunchActivity&quot; /&gt;
&lt;/activity&gt;
</code></pre>

<p>可以看到，这里通过meta-data标签指定了 MainActivity 的父 Activity 是LaunchActivity，在 Android 4.1 版本之后，也可以直接使用<code>android:parentActivityName</code> 这个属性来进行指定，如下所示：</p>

<pre><code class="language-xml">&lt;activity
    android:name=&quot;com.example.actionbartest.MainActivity&quot;
    android:logo=&quot;@drawable/weather&quot;
    android:parentActivityName=&quot;com.example.actionbartest.LaunchActivity&quot; &gt;
&lt;/activity&gt;
</code></pre>

<p>第三步则需要对android.R.id.home这个事件进行一些特殊处理，如下所示：</p>

<pre><code class="language-java">@Override
public boolean onOptionsItemSelected(MenuItem item) {
    switch (item.getItemId()) {
    case android.R.id.home:
        Intent upIntent = NavUtils.getParentActivityIntent(this);
        if (NavUtils.shouldUpRecreateTask(this, upIntent)) {
            TaskStackBuilder.create(this)
                    .addNextIntentWithParentStack(upIntent)
                    .startActivities();
        } else {
            upIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
            NavUtils.navigateUpTo(this, upIntent);
        }
        return true;
        ......
    }
}
</code></pre>

<p>其中，调用NavUtils.getParentActivityIntent()方法可以获取到跳转至父Activity的Intent，然后如果父Activity和当前Activity是在同一个Task中的，则直接调用navigateUpTo()方法进行跳转，如果不是在同一个Task中的，则需要借助TaskStackBuilder来创建一个新的Task。</p>

<p>这样，就按照标准的规范成功实现ActionBar导航的功能了。</p>

<h2 id="toc_5">添加 Action View</h2>

<p>ActionView 是一种可以在 ActionBar 中替换 Action 按钮的控件，它可以允许用户在不切换界面的情况下通过 ActionBar 完成一些较为丰富的操作。比如说，你需要完成一个搜索功能，就可以将 SeachView 这个控件添加到 ActionBar 中。在我的这个应用中，将提供在搜索地点功能。</p>

<p>为了声明一个ActionView，我们可以在 menu 资源中通过 actionViewClass 属性来指定一个控件，例如可以使用如下方式添加 SearchView:</p>

<pre><code class="language-xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
      xmlns:appcompat=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    tools:context=&quot;lgm.cmu.spotagram.ui.MainActivity&quot;&gt;

    &lt;item android:id=&quot;@+id/action_search&quot;
        android:title=&quot;Search&quot;
        app:showAsAction=&quot;ifRoom|collapseActionView&quot;
        appcompat:actionViewClass=&quot;android.support.v7.widget.SearchView&quot;/&gt;

    ....
&lt;/menu&gt;
</code></pre>

<p>注意在 showAsAction 属性中我们还声明了一个 collapseActionView，这个值表示该控件可以被合并成一个 Action 按钮。然后需要在对应的 Activity 中添加方法：</p>

<pre><code class="language-java">@Override
public boolean onCreateOptionsMenu(Menu menu){
   MenuInflater inflater = getMenuInflater();
   inflater.inflate(R.menu.menu_main, menu);

   MenuItem searchItem = menu.findItem(R.id.action_search);
   SearchView searchView = (SearchView) MenuItemCompat.getActionView(searchItem);
   

   searchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {
       @Override
       public boolean onQueryTextChange(String queryText) {
           Toast.makeText(getApplicationContext(), &quot;onQueryTextChange:&quot; + queryText, Toast.LENGTH_SHORT).show();
           return true;
       }

       @Override
       public boolean onQueryTextSubmit(String queryText) {
           Toast.makeText(getApplicationContext(), &quot;onQueryTextSubmit:&quot; + queryText, Toast.LENGTH_SHORT).show();
           return true;
       }
   });

   MenuItemCompat.OnActionExpandListener expandListener = new OnActionExpandListener() {
       @Override
       public boolean onMenuItemActionCollapse(MenuItem item) {
           Toast.makeText(getApplicationContext(), &quot;onMenuItemActionCollapse&quot;, Toast.LENGTH_SHORT).show();
           return true;
       }

       @Override
       public boolean onMenuItemActionExpand(MenuItem item) {
           Toast.makeText(getApplicationContext(), &quot;onMenuItemActionExpand&quot;, Toast.LENGTH_SHORT).show();
           return true;
       }
   };


   MenuItemCompat.setOnActionExpandListener(searchItem, expandListener);

   return super.onCreateOptionsMenu(menu);
}
</code></pre>

<p>这里同时也注册了监听器，所以只要在监听器中进行时间处理即可</p>

<h2 id="toc_6">Overflow 显示问题</h2>

<p>overflow 按钮的显示情况和手机的硬件情况是有关系的，如果手机没有物理 Menu 键的话， overflow 按钮就可以显示，如果有物理 Menu 键的话，overflow 按钮就不会显示出来。</p>

<p>根据这个原理，我们只要默认无论如何都是没有 menu 按键即可。在 ViewConfiguration 这个类中有一个叫做 sHasPermanentMenuKey 的静态变量，系统就是根据这个变量的值来判断手机有没有物理 Menu 键的。当然这是一个内部变量，我们无法直接访问它，但是可以通过反射的方式修改它的值，让它永远为 false 就可以了，代码如下所示</p>

<pre><code class="language-java">@Override
protected void onCreate(Bundle savedInstanceState) {
    ......
    setOverflowShowingAlways();
}

private void setOverflowShowingAlways() {
    try {
        ViewConfiguration config = ViewConfiguration.get(this);
        Field menuKeyField = ViewConfiguration.class.getDeclaredField(&quot;sHasPermanentMenuKey&quot;);
        menuKeyField.setAccessible(true);
        menuKeyField.setBoolean(config, false);
    } catch (Exception e) {
        e.printStackTrace();
    }
}
</code></pre>

<h2 id="toc_7">Overflow 中的选项显示图标</h2>

<p>如果你点击一下overflow按钮去查看隐藏的Action按钮，你会发现这部分Action按钮都是只显示文字不显示图标的。这是官方的默认效果，Google 认为隐藏在 overflow 中的 Action 按钮都应该只显示文字。当然，如果你认为这样不够美观，希望在 overflow 中的 Action 按钮也可以显示图标，我们仍然可以想办法来改变这一默认行为。<br/>
其实，overflow 中的 Action 按钮应不应该显示图标，是由 MenuBuilder 这个类的 setOptionalIconsVisible 方法来决定的，如果我们在 overflow 被展开的时候给这个方法传入 true，那么里面的每一个 Action 按钮对应的图标就都会显示出来了。调用的方法当然仍然是用反射了，代码如下所示</p>

<pre><code class="language-java">@Override
public boolean onMenuOpened(int featureId, Menu menu) {
    if (featureId == Window.FEATURE_ACTION_BAR &amp;&amp; menu != null) {
        if (menu.getClass().getSimpleName().equals(&quot;MenuBuilder&quot;)) {
            try {
                Method m = menu.getClass().getDeclaredMethod(&quot;setOptionalIconsVisible&quot;, Boolean.TYPE);
                m.setAccessible(true);
                m.invoke(menu, true);
            } catch (Exception e) {
            }
        }
    }
    return super.onMenuOpened(featureId, menu);
}
</code></pre>

<p>可以看到，这里我们重写了一个 onMenuOpened() 方法，当 overflow 被展开的时候就会回调这个方法，接着在这个方法的内部通过返回反射的方法将 MenuBuilder 的 setOptionalIconsVisible 变量设置为 true 就可以了。</p>

<h2 id="toc_8">参考资料</h2>

<ul>
<li><a href="http://blog.csdn.net/guolin_blog/article/details/18234477">Android ActionBar完全解析，使用官方推荐的最佳导航栏(上)</a></li>
</ul>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="14520474070782.html"  title="Previous Post: Google Map V2 使用指南">&laquo; Google Map V2 使用指南</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="14520467690026.html" 
	        title="Next Post: iOS 学习路径">iOS 学习路径 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '14520474070736.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </body>
</html>
